The directory contains scripts to perform classifier sensititivity training. These scripts retrain the classifier by adding artificially generated sequence(s) to the training database and calculates number of sequences that changed labels with the inclusion of artificial sequences. 

The RDP classifier doesn't have a multithreaded implementation. To utilize multicore systems efficiently, we split the query file into smaller batches. This step is optional. 
```
usage: Split_Seqs.py [-h] -q QUERY -d DIRECTORY [-b BATCH_SIZE]

This is a script to split a fasta file into smaller batch of sequences. This
is particularly helpful to run the RDP classifier in multiple threads.

optional arguments:
  -h, --help            show this help message and exit
  -q QUERY, --query QUERY
                        A fasta file of query sequences.
  -d DIRECTORY, --directory DIRECTORY
                        directory to write the split up fasta file.
  -b BATCH_SIZE, --batch_size BATCH_SIZE
                        size of the smaller fasta files
```

To test classifier's sensitivity to worst-case artificial sequences run this python program. The input to this program would ba fasta file containing artificial sequences generated by running ```Sample_Adversarial_Sequences.py``` and a query file. The query can be either single fasta file or a directory containing the split sequences obtained by running ```Split_Seqs```. 

```
usage: Classifier_Sensitivity_Training.py [-h] -q QUERY -a
                                          ADVERSARIAL_SEQUENCES -GA GENUS_A
                                          [-GB GENUS_B] -o OUTPUT
                                          [-d RDP_WO_ADVERSARIAL] -rdp
                                          RDP_CLASSIFIER -db RDP_DB -taxa TAXA
                                          [--split] [--iterative] [--reverse]
                                          [--run_vanilla] [-nt THREADS]

This is a script to perform classfier senstivity training based on the
adversarial sequences genrated by Sample_Adversarial_Sequences.py. The script
takes the fasta file of query sequences, adversarial sequences and RDP
databases and classifier returns a summary of sequences that change labels
with the addition of a single noisy transitively annotated sequence. To study
the senstivity of the classifier to multiple adversarial sequences, we allow a
flag -f which iteratively add multiple sequences. To allow for efficient
running of the RDP classifier, the program takes as input a directory
containing fasta files of the query sequence split into smaller subsets. Run
with --split option if passing a directory of query sequences.

optional arguments:
  -h, --help            show this help message and exit
  -q QUERY, --query QUERY
                        A fasta file of sequences or a directory of fasta
                        files containing split up query sequences.
  -a ADVERSARIAL_SEQUENCES, --adversarial_sequences ADVERSARIAL_SEQUENCES
                        A fasta file of adversarial sequences sampled while
                        transforming Genus GA to Genus GB.
  -GA GENUS_A, --Genus_A GENUS_A
                        Genus A
  -GB GENUS_B, --Genus_B GENUS_B
                        Genus B
  -o OUTPUT, --output OUTPUT
                        Directory to write outputs to.
  -d RDP_WO_ADVERSARIAL, --RDP_wo_adversarial RDP_WO_ADVERSARIAL
                        Results of running the RDP classifer without any
                        adversarial example. Required if --run_vanilla is
                        disabled.
  -rdp RDP_CLASSIFIER, --rdp_classifier RDP_CLASSIFIER
                        Directory containing the RDP classifier program.
  -db RDP_DB, --rdp_DB RDP_DB
                        Directory containing the trained RDP database.
  -taxa TAXA, --taxa TAXA
                        Taxa file for training the RDP classifier
  --split               Flag to indicate if a directory of split query
                        sequences is passed.
  --iterative           Flag to indicate to iteratively add mutliple
                        adversarial sequences.
  --reverse             Add the reverse compliment of adversarial sequence to
                        the training data.
  --run_vanilla         Flag to indicate if the RDP classifier is run without
                        adversarial sequences
  -nt THREADS, --threads THREADS
                        Number of threads to run the RDP classifier
```

As a base-line we added the query sequences to study the sensitivity of the RDP classifier. To sample query sequences we run the ```Transitive-Annotation-Control.py``` program. We ensure that the query sequences added as control are used for generating edit paths to ensure fair comparison between worstcase adversarial examples and controls. 
```
usage: Transitive-Annotation-Control.py [-h] -q QUERY -db RDP_DB -rdp
                                        RDP_CLASSIFIER -a
                                        ADVERSARIAL_SEQUENCES -taxa TAXA -o
                                        OUTPUT

This is a script to sample query sequences to be used as controls.

optional arguments:
  -h, --help            show this help message and exit
  -q QUERY, --query QUERY
                        A fasta file of sequences or a directory of fasta
                        files containing split up query sequences.
  -db RDP_DB, --rdp_DB RDP_DB
                        Directory containing the trained RDP database.
  -rdp RDP_CLASSIFIER, --rdp_classifier RDP_CLASSIFIER
                        Directory containing the RDP classifier program.
  -a ADVERSARIAL_SEQUENCES, --adversarial_sequences ADVERSARIAL_SEQUENCES
                        Directory containing fasta files of adversarial
                        sequences.
  -taxa TAXA, --taxa TAXA
                        Taxa file for training the RDP classifier
  -o OUTPUT, --output OUTPUT
                        Directory to write outputs to.
```

To perform classifier sensitivity training on control sequences, we run,

```
usage: Classifier_Sensitivity_Training_Controls.py [-h] -q QUERY -o OUTPUT
                                                   [-d RDP_WO_ADVERSARIAL] -s
                                                   SAMPLE -rdp RDP_CLASSIFIER
                                                   -db RDP_DB -taxa TAXA
                                                   [--split] [--reverse]
                                                   [--run_vanilla]
                                                   [-nt THREADS]

This is a script to perform classfier senstivity training by adding in
transitively annotated query sequences.

optional arguments:
  -h, --help            show this help message and exit
  -q QUERY, --query QUERY
                        A fasta file of sequences or a directory of fasta
                        files containing split up query sequences.
  -o OUTPUT, --output OUTPUT
                        Directory to write outputs to.
  -d RDP_WO_ADVERSARIAL, --RDP_wo_adversarial RDP_WO_ADVERSARIAL
                        Results of running the RDP classifer without any
                        adversarial example. Required if --run_vanilla is
                        disabled.
  -s SAMPLE, --sample SAMPLE
                        A fasta file to add query sequences as control
  -rdp RDP_CLASSIFIER, --rdp_classifier RDP_CLASSIFIER
                        Directory containing the RDP classifier program.
  -db RDP_DB, --rdp_DB RDP_DB
                        Directory containing the trained RDP database.
  -taxa TAXA, --taxa TAXA
                        Taxa file for training the RDP classifier
  --split               Flag to indicate if a directory of split query
                        sequences is passed.
  --reverse             Add the reverse compliment of adversarial sequence to
                        the training data.
  --run_vanilla         Flag to indicate if the RDP classifier is run without
                        adversarial sequences
  -nt THREADS, --threads THREADS
                        Number of threads to run the RDP classifier
```